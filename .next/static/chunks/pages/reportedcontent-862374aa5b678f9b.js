(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[748],{151:(e,t,s)=>{"use strict";s.d(t,{H:()=>r});let r="https://matrimonial-backend-7ahc.onrender.com"},3703:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/reportedcontent",function(){return s(8256)}])},7814:(e,t,s)=>{"use strict";s.d(t,{G1:()=>n,Ol:()=>c,cH:()=>l});var r=s(2692);let a=null;function l(e){return a&&a.connected||((a=(0,r.io)("https://matrimonial-backend-7ahc.onrender.com",{transports:["websocket"],secure:!0,reconnection:!0,reconnectionAttempts:10,path:"/socket.io",query:{adminId:e}})).on("connect",()=>{console.log("\uD83D\uDD35 SOCKET CONNECTED:",a.id)}),a.on("disconnect",()=>{console.log("\uD83D\uDD34 SOCKET DISCONNECTED")})),a}function n(){a&&(a.disconnect(),console.log("\uD83D\uDD34 SOCKET MANUALLY DISCONNECTED"))}function c(){return a}},8256:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>g});var r=s(7876),a=s(4232),l=s(2577),n=s(7814);let c=()=>{let[e,t]=(0,a.useState)([]),[s,c]=(0,a.useState)(!1),o=(0,a.useRef)(null),i="https://matrimonial-backend-7ahc.onrender.com",d=async()=>{try{let e=localStorage.getItem("token"),t=await fetch("".concat(i,"/admin/profile"),{headers:{Authorization:"Bearer ".concat(e)}}),s=await t.json();if(s.success){let e=s.data;!0===e.notifications?(0,n.cH)(e._id):(0,n.G1)()}}catch(e){console.log("Admin Pref Error:",e)}};(0,a.useEffect)(()=>{d()},[]);let x=async()=>{try{let e=localStorage.getItem("token"),s=await fetch("".concat(i,"/api/notification/me"),{headers:{Authorization:"Bearer ".concat(e)}}),r=await s.json();r.success&&t(r.data.reverse())}catch(e){console.log("Fetch Notification Error:",e)}};(0,a.useEffect)(()=>{x()},[]),(0,a.useEffect)(()=>{let e=(0,n.Ol)();if(e)return console.log("\uD83D\uDFE2 Real-time listener active..."),e.on("new-notification",e=>{console.log("\uD83D\uDD14 New Real-Time Notification:",e),t(t=>[e,...t])}),()=>{let e=(0,n.Ol)();e&&e.off("new-notification")}},[]),(0,a.useEffect)(()=>{let e=e=>{o.current&&!o.current.contains(e.target)&&c(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let m=async e=>{let s=localStorage.getItem("token");await fetch("".concat(i,"/api/notification/mark-read/").concat(e),{method:"PATCH",headers:{Authorization:"Bearer ".concat(s)}}),t(t=>t.map(t=>t._id===e?{...t,read:!0}:t))},p=async()=>{let e=localStorage.getItem("token");await fetch("".concat(i,"/api/notification/mark-all"),{method:"PATCH",headers:{Authorization:"Bearer ".concat(e)}}),t(e=>e.map(e=>({...e,read:!0})))},h=async e=>{let s=localStorage.getItem("token");await fetch("".concat(i,"/api/notification/").concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(s)}}),t(t=>t.filter(t=>t._id!==e))},u=async()=>{let s=localStorage.getItem("token");await Promise.all(e.map(e=>fetch("".concat(i,"/api/notification/").concat(e._id),{method:"DELETE",headers:{Authorization:"Bearer ".concat(s)}}))),t([])},g=e.filter(e=>!e.read).length;return(0,r.jsxs)("div",{className:"w-full bg-[#f5f5f5] py-3 px-4 border-b flex items-center justify-between",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-black",children:"Reported Content"}),(0,r.jsx)("div",{className:"flex items-center gap-4",children:(0,r.jsxs)("div",{className:"relative",ref:o,children:[(0,r.jsxs)("div",{className:"cursor-pointer relative",onClick:()=>c(!s),children:[(0,r.jsx)(l.A,{className:"h-7 w-7 text-yellow-500"}),g>0&&(0,r.jsx)("span",{className:"absolute -top-1 -right-1 h-4 w-4 bg-red-600 text-white text-[10px] flex items-center justify-center rounded-full border-2 border-white",children:g})]}),s&&(0,r.jsxs)("div",{className:"absolute right-0 mt-3 w-[330px] bg-white shadow-lg border rounded-lg p-3 z-50",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,r.jsx)("h2",{className:"font-semibold text-gray-800",children:"Notifications"}),(0,r.jsx)("button",{onClick:p,className:"text-blue-600 text-sm",children:"Mark all read"})]}),(0,r.jsx)("div",{className:"max-h-[300px] overflow-y-auto",children:0===e.length?(0,r.jsx)("p",{className:"text-center text-gray-500 py-3",children:"No notifications"}):e.map(e=>(0,r.jsxs)("div",{className:"p-3 border-b flex justify-between items-start ".concat(e.read?"":"bg-yellow-50"),children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold",children:e.title}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:e.message}),(0,r.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:new Date(e.createdAt).toLocaleString()}),!e.read&&(0,r.jsx)("button",{onClick:()=>m(e._id),className:"text-blue-600 text-xs mt-1",children:"Mark as read"})]}),(0,r.jsx)("button",{onClick:()=>h(e._id),className:"text-red-500 text-sm",children:"Delete"})]},e._id))}),e.length>0&&(0,r.jsx)("button",{onClick:u,className:"w-full text-red-600 mt-2 py-2 text-sm border-t",children:"Delete All"})]})]})})]})};var o=s(9516),i=s(4250),d=s.n(i),x=s(151);let m=e=>{let{report:t,onClose:s,refreshReports:a}=e;if(!t)return null;let{reporter:l,reportedUser:n,title:c,description:o,image:i,status:m,createdAt:p}=t,h=async e=>{try{let r=await fetch("".concat(x.H,"/admin/report/status/").concat(t._id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"approve"===e?"approved":"rejected"})}),l=await r.json();console.log("API Response:",l),l.success?(alert("Report has been ".concat("approve"===e?"approved":"rejected")),s(),a()):alert(l.message||"Something went wrong")}catch(e){console.error("Error in handleAction:",e),alert("Error processing action")}};return(0,r.jsxs)("div",{id:"backdrop",onClick:e=>{"backdrop"===e.target.id&&s()},className:"jsx-335342c2f5390679 fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm px-4 py-10",children:[(0,r.jsxs)("div",{onClick:e=>e.stopPropagation(),className:"jsx-335342c2f5390679 relative bg-white/90 backdrop-blur-lg border border-white/40 rounded-3xl shadow-2xl max-w-xl w-full p-8 animate-scaleIn",children:[(0,r.jsxs)("div",{className:"jsx-335342c2f5390679 flex justify-between items-center mb-6",children:[(0,r.jsxs)("div",{className:"jsx-335342c2f5390679 flex items-center gap-2",children:[(0,r.jsx)("div",{className:"jsx-335342c2f5390679 "+"w-3 h-3 rounded-full ".concat("rejected"===m?"bg-red-500":"approved"===m?"bg-green-500":"bg-yellow-400")}),(0,r.jsx)("span",{className:"jsx-335342c2f5390679 text-sm font-medium capitalize text-gray-800",children:m})]}),(0,r.jsxs)("span",{className:"jsx-335342c2f5390679 text-sm text-gray-600",children:["Reported on: ",new Date(p).toLocaleDateString()]})]}),(0,r.jsx)("div",{className:"jsx-335342c2f5390679 grid grid-cols-1 sm:grid-cols-2 gap-6 mb-6",children:[n,l].map((e,t)=>(0,r.jsxs)("div",{className:"jsx-335342c2f5390679 bg-white rounded-xl border border-gray-200 p-5 flex flex-col items-center text-center hover:shadow-md transition",children:[(0,r.jsx)("img",{src:(null==e?void 0:e.avatar)||(null==e?void 0:e.profileImage)||"/default-profile.png",alt:"User",className:"jsx-335342c2f5390679 w-20 h-20 rounded-full border object-cover shadow"}),(0,r.jsx)("h3",{className:"jsx-335342c2f5390679 font-semibold text-lg text-gray-800 mt-3",children:(null==e?void 0:e.name)||(null==e?void 0:e.fullName)||"Unnamed User"}),(0,r.jsx)("p",{className:"jsx-335342c2f5390679 text-xs text-blue-500 mt-1",children:1===t?"Reporter":"Reported User"})]},t))}),(0,r.jsxs)("div",{className:"jsx-335342c2f5390679 mb-4",children:[(0,r.jsx)("h4",{className:"jsx-335342c2f5390679 font-semibold text-base mb-1",children:"Reason:"}),(0,r.jsx)("p",{className:"jsx-335342c2f5390679 text-sm text-gray-700 leading-relaxed bg-gray-100 border border-gray-200 rounded-lg p-4 mt-1",children:c}),(0,r.jsx)("h4",{className:"jsx-335342c2f5390679 font-semibold text-base mb-1 mt-4",children:"Description:"}),(0,r.jsx)("p",{className:"jsx-335342c2f5390679 text-sm text-gray-700 leading-relaxed bg-gray-100 border border-gray-200 rounded-lg p-4 mt-1",children:o})]}),(null==i?void 0:i.length)>0&&(0,r.jsxs)("div",{className:"jsx-335342c2f5390679 mb-4",children:[(0,r.jsxs)("h4",{className:"jsx-335342c2f5390679 text-sm font-semibold text-gray-800 mb-2",children:["Attached Screenshot",i.length>1?"s":"",":"]}),(0,r.jsx)("div",{className:"jsx-335342c2f5390679 flex flex-wrap gap-2",children:i.map((e,t)=>(0,r.jsxs)("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"jsx-335342c2f5390679 text-sm text-blue-600 bg-blue-100 hover:bg-blue-200 px-3 py-1 rounded-md transition",children:["\uD83D\uDCCE Screenshot_",t+1,".jpg"]},t))})]}),(0,r.jsxs)("div",{className:"jsx-335342c2f5390679 flex justify-end gap-4 mt-8",children:[(0,r.jsx)("button",{onClick:()=>h("approve"),className:"jsx-335342c2f5390679 bg-green-500 hover:bg-green-600 text-white px-5 py-2 rounded-full font-semibold shadow",children:"Approve"}),(0,r.jsx)("button",{onClick:()=>h("reject"),className:"jsx-335342c2f5390679 bg-red-500 hover:bg-red-600 text-white px-5 py-2 rounded-full font-semibold shadow",children:"Reject"})]})]}),(0,r.jsx)(d(),{id:"335342c2f5390679",children:".animate-scaleIn.jsx-335342c2f5390679{animation:scaleIn.3s ease-out}@keyframes scaleIn{0%{transform:scale(.95);opacity:0}100%{transform:scale(1);opacity:1}}"})]})},p=e=>{let{active:t,direction:s}=e;return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center ml-1 mt-[2px] leading-[0.4]",children:[(0,r.jsx)("div",{className:"w-2 h-2 rotate-45 border-t-2 border-l-2 ".concat(t&&"asc"===s?"border-gray-700":"border-gray-400")}),(0,r.jsx)("div",{className:"w-2 h-2 rotate-45 border-b-2 border-r-2 mt-[3px] ".concat(t&&"desc"===s?"border-gray-700":"border-gray-400")})]})},h=e=>{let{report:t,currentPage:s,totalPages:l,setCurrentPage:n,refreshReports:c}=e,[o,i]=(0,a.useState)(null),[d,x]=(0,a.useState)({key:null,direction:"asc"}),h=e=>{x(t=>({key:e,direction:t.key===e&&"asc"===t.direction?"desc":"asc"}))},u=(0,a.useMemo)(()=>d.key?[...t].sort((e,t)=>{var s,r,a,l,n,c,o,i;let x="",m="";switch(d.key){case"reportedUser":x=(null==(s=e.reportedUser)?void 0:s.fullName)||(null==(r=e.reportedUser)?void 0:r.name)||"",m=(null==(a=t.reportedUser)?void 0:a.fullName)||(null==(l=t.reportedUser)?void 0:l.name)||"";break;case"reportDate":x=new Date(e.createdAt),m=new Date(t.createdAt);break;case"reporterUser":x=(null==(n=e.reporter)?void 0:n.fullName)||(null==(c=e.reporter)?void 0:c.name)||"",m=(null==(o=t.reporter)?void 0:o.fullName)||(null==(i=t.reporter)?void 0:i.name)||""}return x<m?"asc"===d.direction?-1:1:x>m?"asc"===d.direction?1:-1:0}):t,[t,d]),g=e=>(null==e?void 0:e.profileImage)||"/default-profile.png",f=e=>(null==e?void 0:e.fullName)||(null==e?void 0:e.name)||"Unknown User",j=e=>(null==e?void 0:e.userId)?"#".concat(e.userId):"#------",b=e=>(null==e?void 0:e.gender)||"N/A";return(0,r.jsxs)("div",{className:"bg-white  px-1",children:[(0,r.jsx)("div",{className:"w-full h-[1px] bg-gray-500 mb-2"}),(0,r.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:" border-b border-gray-500",children:[(0,r.jsx)("th",{className:"py-3 px-2 cursor-pointer font-semibold",onClick:()=>h("reportedUser"),children:(0,r.jsxs)("div",{className:"flex items-center gap-1",children:["Reported User",(0,r.jsx)(p,{active:"reportedUser"===d.key,direction:d.direction})]})}),(0,r.jsx)("th",{className:"py-3 px-2 cursor-pointer font-semibold",onClick:()=>h("reportDate"),children:(0,r.jsxs)("div",{className:"flex items-center gap-1",children:["Report Date",(0,r.jsx)(p,{active:"reportDate"===d.key,direction:d.direction})]})}),(0,r.jsx)("th",{className:"py-3 px-2 cursor-pointer font-semibold",onClick:()=>h("reporterUser"),children:(0,r.jsxs)("div",{className:"flex items-center gap-1",children:["Reporter User",(0,r.jsx)(p,{active:"reporterUser"===d.key,direction:d.direction})]})}),(0,r.jsx)("th",{className:"py-3 px-2 font-semibold",children:"Reason"}),(0,r.jsx)("th",{className:"py-3 px-2 font-semibold",children:"Status"}),(0,r.jsx)("th",{className:"py-3 px-2 font-semibold",children:"Actions"})]})}),(0,r.jsx)("tbody",{children:u.map(e=>(0,r.jsxs)("tr",{className:"border-t border-gray-300 hover:bg-gray-50 transition",children:[(0,r.jsx)("td",{className:"py-[14px] px-3 align-middle",children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("img",{src:g(e.reportedUser),className:"w-11 h-11 rounded-full object-cover"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-semibold",children:f(e.reportedUser)}),(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:[j(e.reportedUser)," /"," ",b(e.reportedUser)]})]})]})}),(0,r.jsx)("td",{className:"py-[14px] px-3 align-middle",children:new Date(e.createdAt).toLocaleDateString("en-GB",{day:"2-digit",month:"long",year:"numeric"})}),(0,r.jsx)("td",{className:"py-[14px] px-3 align-middle",children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("img",{src:g(e.reporter),className:"w-11 h-11 rounded-full object-cover"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-semibold",children:f(e.reporter)}),(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:[j(e.reporter)," / ",b(e.reporter)]})]})]})}),(0,r.jsx)("td",{className:"py-[14px] px-3 align-middle",children:e.title}),(0,r.jsx)("td",{className:"py-[14px] px-3 align-middle",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"w-3 h-3 rounded-full ".concat((e=>"approved"===(e=null==e?void 0:e.toLowerCase())?"bg-green-500":"pending"===e?"bg-yellow-500":"bg-red-500")(e.status))}),(0,r.jsx)("span",{children:e.status})]})}),(0,r.jsx)("td",{className:"py-[14px] px-3 align-middle",children:(0,r.jsx)("div",{className:"flex items-center gap-3",children:(0,r.jsx)("button",{className:"text-gray-700",onClick:()=>i(e),children:"View"})})})]},e._id))})]}),(0,r.jsxs)("div",{className:"flex justify-center items-center gap-3 mt-4 text-sm",children:[(0,r.jsx)("button",{disabled:1===s,onClick:()=>n(s-1),children:"◀ Prev"}),[...Array(l)].map((e,t)=>(0,r.jsx)("button",{onClick:()=>n(t+1),className:"".concat(s===t+1?"font-bold underline":"text-gray-600"),children:t+1},t)),(0,r.jsx)("span",{children:"....."}),(0,r.jsx)("button",{disabled:s===l,onClick:()=>n(s+1),children:"Next ▶"})]}),o&&(0,r.jsx)(m,{report:o,onClose:()=>i(null),refreshReports:c})]})},u=()=>{let[e,t]=(0,a.useState)([]),[s,l]=(0,a.useState)(""),[n,c]=(0,a.useState)("all"),[i,d]=(0,a.useState)(""),[m,p]=(0,a.useState)(1),[u,g]=(0,a.useState)(1),f=async()=>{try{let e=await fetch("".concat(x.H,"/admin/report-analize?search=").concat(s,"&status=").concat(n,"&gender=").concat(i,"&page=").concat(m,"&limit=").concat(10)),r=await e.json();t(r.reports||[]),g(r.totalPages||1)}catch(e){console.error("Failed to fetch reports:",e)}};(0,a.useEffect)(()=>{f()},[s,n,i,m]);let j=e.length,b=e.filter(e=>{var t;return(null==(t=e.status)?void 0:t.toLowerCase())==="pending"}).length,v=e.filter(e=>{var t,s;return(null==(t=e.status)?void 0:t.toLowerCase())==="reviewed"||(null==(s=e.status)?void 0:s.toLowerCase())==="approved"}).length,N=e.filter(e=>{var t;return(null==(t=e.status)?void 0:t.toLowerCase())==="blocked"}).length;return(0,r.jsxs)("div",{className:"p-5",children:[(0,r.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6 px-10 mb-10",children:[{label:"Total Reports This Week",value:j},{label:"Pending Report Review",value:b},{label:"Action Taken",value:v},{label:"Blocked User",value:N}].map(e=>{let{label:t,value:s}=e;return(0,r.jsxs)("div",{className:"bg-white border border-gray-300 rounded-xl shadow-sm p-6 flex flex-col justify-center items-center",style:{height:"150px"},children:[(0,r.jsx)("p",{className:"text-lg font-semibold text-gray-800 text-center",children:t}),(0,r.jsx)("p",{className:"text-3xl font-bold text-gray-900 mt-4",children:(e=>e>=1e3?(e/1e3).toFixed(1)+" K":e)(s)})]},t)})}),(0,r.jsxs)("div",{className:"border mt-5 p-4 bg-white border-gray-400 rounded",children:[(0,r.jsx)("div",{className:"bg-gray-100 p-2 rounded-lg shadow-sm border border-gray-400 mb-2",children:(0,r.jsxs)("div",{className:" flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[(0,r.jsxs)("div",{className:" relative w-full  md:max-w-sm",children:[(0,r.jsx)(o.A,{className:" absolute left-3 top-1/2 transform -translate-y-1/2  text-gray-400 w-4 h-4"}),(0,r.jsx)("input",{type:"text",placeholder:"Search by name or email",value:s,onChange:e=>{p(1),l(e.target.value)},className:"w-full pl-10 pr-4 py-2  bg-white border  border-gray-400 rounded-lg focus:ring-2 focus:ring-gray-200"})]}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,r.jsxs)("select",{value:n,onChange:e=>{p(1),c(e.target.value)},className:"px-3 py-2 border bg-gray-300 border-gray-400 rounded-lg",children:[(0,r.jsx)("option",{value:"all",children:" Status"}),(0,r.jsx)("option",{value:"pending",children:"Pending"}),(0,r.jsx)("option",{value:"approved",children:"Approved"}),(0,r.jsx)("option",{value:"blocked",children:"Blocked"})]}),(0,r.jsxs)("select",{value:i,onChange:e=>{p(1),d(e.target.value)},className:"px-3 py-2 border bg-gray-300 border-gray-400 rounded-lg",children:[(0,r.jsx)("option",{value:"",children:" Genders"}),(0,r.jsx)("option",{value:"Male",children:"Male"}),(0,r.jsx)("option",{value:"Female",children:"Female"})]})]})]})}),(0,r.jsx)(h,{report:e,currentPage:m,totalPages:u,setCurrentPage:p,itemsPerPage:10,refreshReports:f})]})]})},g=()=>(0,r.jsxs)("div",{className:"h-screen flex flex-col",children:[(0,r.jsx)("div",{className:"shadow-md sticky top-0 z-30 bg-[#f5f5f5]",children:(0,r.jsx)(c,{})}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,r.jsx)(u,{})})]})}},e=>{e.O(0,[692,151,636,593,792],()=>e(e.s=3703)),_N_E=e.O()}]);